name: Update Lotto Data

# ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 1:00 (KST ê¸°ì¤€, UTCëŠ” 16:00 í† ìš”ì¼)ì— ì‹¤í–‰
on:
  schedule:
    - cron: '0 16 * * 6'  # ë§¤ì£¼ í† ìš”ì¼ 16:00 UTC (í•œêµ­ ì¼ìš”ì¼ 01:00)
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸ Python ì„¤ì •
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          pip install requests firebase-admin beautifulsoup4
      
      - name: ğŸ° ë¡œë˜ ë°ì´í„° ì—…ë°ì´íŠ¸
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          FCM_TOPIC: ${{ secrets.FCM_TOPIC }}
        run: |
          python update_lotto_data.py
      
      - name: ğŸ“Š ë³€ê²½ì‚¬í•­ í™•ì¸
        id: check_changes
        run: |
          if git diff --quiet; then
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "âœ… ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          else
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "ğŸ”„ ë³€ê²½ì‚¬í•­ ë°œê²¬"
          fi
      
      - name: ğŸ’¾ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add lotto-history.json
          git commit -m "ğŸ° ìë™ ì—…ë°ì´íŠ¸: $(date +'%Y-%m-%d %H:%M:%S KST')"
          git push
      
      - name: âœ… ì™„ë£Œ
        run: |
          echo "ğŸ‰ ì‘ì—… ì™„ë£Œ!"